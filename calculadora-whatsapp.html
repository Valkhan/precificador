<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Calculadora WhatsApp - Preços por Categoria | Valkhan Tech</title>
    <meta name="description" content="Ferramenta interna para calcular custo e rentabilidade de mensagens WhatsApp por categoria.">
    <meta name="keywords" content="whatsapp, calculadora, preços, mensagens, categoria, custos, rentabilidade">
    <meta name="author" content="Valkhan Tech">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://valkhan.com.br/favicon.ico">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" 
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="css/style.css" rel="stylesheet">
    
    <style>
        .categoria-card {
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .categoria-card h5 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .range-slider {
            width: 100%;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3498db;
            cursor: pointer;
            border-radius: 50%;
        }
        
        .range-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3498db;
            cursor: pointer;
            border-radius: 50%;
        }
        
        .dolar-info {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .resultado-tabela {
            margin-top: 30px;
        }
        
        .table-custom {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .table-custom th {
            background: #3498db;
            color: white;
            font-weight: 600;
        }
        
        .valor-positivo {
            color: #27ae60;
            font-weight: bold;
        }
        
        .valor-negativo {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .resumo-final {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header id="header" class="header fixed-top">
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <h1 class="logo">
                    <a href="https://valkhan.com.br" target="_blank">
                        <img src="https://valkhan.com.br/img/logos/logoVlkT.svg" alt="Valkhan Tech Logo" class="logoImg">
                        <span>Valkhan Tech</span>
                    </a>
                </h1>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon">
                        <i class="fas fa-bars text-white"></i>
                    </span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#calculadora">Calculadora</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Precificador</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://valkhan.com.br" target="_blank">Site Principal</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container-fluid">
            <div class="main-container">
                <h1 class="page-title" id="calculadora">
                    <i class="fab fa-whatsapp me-3"></i>
                    Calculadora WhatsApp - Preços por Categoria
                    <small class="text-muted d-block mt-2">Ferramenta interna para cálculo de custos e rentabilidade</small>
                </h1>

                <div class="row">
                    <!-- Configuração de Mensagens -->
                    <div class="col-12 col-lg-6">
                        <div class="categoria-card">
                            <h5><i class="fas fa-server me-2"></i>Plano de Assinatura</h5>
                            <p class="text-muted">Selecione a faixa de conversas mensais</p>
                            <div class="mb-3">
                                <select class="form-select" id="plano-select">
                                    <option value="0">Plano Básico (sem conversas)</option>
                                    <option value="10000">Até 10.000 conversas/mês</option>
                                    <option value="30000">Até 30.000 conversas/mês</option>
                                    <option value="50000">Até 50.000 conversas/mês</option>
                                    <option value="100000">Até 100.000 conversas/mês</option>
                                    <option value="500000">Até 500.000 conversas/mês</option>
                                    <option value="1000000">Até 1.000.000 conversas/mês</option>
                                </select>
                            </div>                            <div class="row text-center mt-3">
                                <div class="col-4">
                                    <small class="text-muted">Rateio</small>
                                    <div class="fw-bold" id="plano-rateio">R$ 0,00</div>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted">Mensalidade</small>
                                    <div class="fw-bold" id="plano-mensalidade">R$ 0,00</div>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted">Por Conversa</small>
                                    <div class="fw-bold" id="plano-unitario">R$ 0,00</div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <label class="form-label">Mensalidade Customizada (R$)</label>
                                    <input type="number" class="form-control form-control-sm" 
                                           id="plano-mensalidade-custom" step="25" min="0" 
                                           placeholder="Deixe vazio para usar valor padrão">
                                    <small class="text-muted">Valor será arredondado para múltiplos de 25</small>
                                </div>
                            </div>
                        </div>

                        <div class="categoria-card">
                            <h5><i class="fas fa-bullhorn me-2"></i>Marketing</h5>
                            <p class="text-muted">Custo: $0,0625 por mensagem</p>
                            <div class="row mb-3">
                                <div class="col-6">
                                    <label class="form-label">Preço Custo (R$)</label>
                                    <input type="number" class="form-control form-control-sm" 
                                           id="marketing-preco-custo" step="0.0001" min="0">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Preço Venda (R$)</label>
                                    <input type="number" class="form-control form-control-sm" 
                                           id="marketing-preco-venda" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="slider-container">
                                <div class="slider-value">
                                    <span id="marketing-value">0</span> mensagens
                                </div>
                                <input type="range" class="range-slider" id="marketing-slider" 
                                       min="0" max="1000000" step="1000" value="0">
                            </div>
                            <div class="row text-center mt-3">
                                <div class="col-6">
                                    <small class="text-muted">Custo Total</small>
                                    <div class="fw-bold" id="marketing-custo">R$ 0,00</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Faturamento</small>
                                    <div class="fw-bold text-success" id="marketing-faturamento">R$ 0,00</div>
                                </div>
                            </div>
                        </div>

                        <div class="categoria-card">
                            <h5><i class="fas fa-tools me-2"></i>Utilidade</h5>
                            <p class="text-muted">Custo: $0,008 por mensagem</p>
                            <div class="row mb-3">
                                <div class="col-6">
                                    <label class="form-label">Preço Custo (R$)</label>
                                    <input type="number" class="form-control form-control-sm" 
                                           id="utilidade-preco-custo" step="0.0001" min="0">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Preço Venda (R$)</label>
                                    <input type="number" class="form-control form-control-sm" 
                                           id="utilidade-preco-venda" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="slider-container">
                                <div class="slider-value">
                                    <span id="utilidade-value">0</span> mensagens
                                </div>
                                <input type="range" class="range-slider" id="utilidade-slider" 
                                       min="0" max="1000000" step="1000" value="0">
                            </div>
                            <div class="row text-center mt-3">
                                <div class="col-6">
                                    <small class="text-muted">Custo Total</small>
                                    <div class="fw-bold" id="utilidade-custo">R$ 0,00</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Faturamento</small>
                                    <div class="fw-bold text-success" id="utilidade-faturamento">R$ 0,00</div>
                                </div>
                            </div>
                        </div>

                        <div class="categoria-card">
                            <h5><i class="fas fa-shield-alt me-2"></i>Autenticação</h5>
                            <p class="text-muted">Custo: $0,0315 por mensagem</p>
                            <div class="row mb-3">
                                <div class="col-6">
                                    <label class="form-label">Preço Custo (R$)</label>
                                    <input type="number" class="form-control form-control-sm" 
                                           id="autenticacao-preco-custo" step="0.0001" min="0">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Preço Venda (R$)</label>
                                    <input type="number" class="form-control form-control-sm" 
                                           id="autenticacao-preco-venda" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="slider-container">
                                <div class="slider-value">
                                    <span id="autenticacao-value">0</span> mensagens
                                </div>
                                <input type="range" class="range-slider" id="autenticacao-slider" 
                                       min="0" max="1000000" step="1000" value="0">
                            </div>
                            <div class="row text-center mt-3">
                                <div class="col-6">
                                    <small class="text-muted">Custo Total</small>
                                    <div class="fw-bold" id="autenticacao-custo">R$ 0,00</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Faturamento</small>
                                    <div class="fw-bold text-success" id="autenticacao-faturamento">R$ 0,00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resultados -->
                    <div class="col-12 col-lg-6">
                        <div class="resultado-tabela">
                            <h4><i class="fas fa-chart-line me-2"></i>Análise de Investimento</h4>
                            <table class="table table-custom">
                                <thead>
                                    <tr>
                                        <th>Cenário</th>
                                        <th>Plano</th>
                                        <th>Custo p/msg</th>
                                        <th>Faturamento</th>
                                    </tr>
                                </thead>
                                <tbody id="tabela-resultados">
                                    <!-- Resultados serão inseridos aqui -->
                                </tbody>
                            </table>
                        </div>

                        <div class="resumo-final">
                            <h5><i class="fas fa-calculator me-2"></i>Resumo Financeiro</h5>
                            <div class="row justify-content-evenly">
                                <div class="col-6 col-md-2 text-center mb-3">
                                    <h6>Total Mensagens</h6>
                                    <strong id="total-mensagens">0</strong>
                                </div>
                                <div class="col-6 col-md-2 text-center mb-3">
                                    <h6>Custo Total</h6>
                                    <strong class="text-danger" id="custo-total">R$ 0,00</strong>
                                </div>
                                <div class="col-6 col-md-2 text-center mb-3">
                                    <h6>Faturamento Total</h6>
                                    <strong class="text-primary" id="faturamento-total">R$ 0,00</strong>
                                </div>
                                <div class="col-6 col-md-2 text-center mb-3">
                                    <h6>Custo Médio p/msg</h6>
                                    <strong id="custo-medio-msg">R$ 0,00</strong>
                                </div>
                                <div class="col-6 col-md-2 text-center mb-3">
                                    <h6>Rentabilidade</h6>
                                    <strong id="rentabilidade-total">0%</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Informações do Dólar -->
                        <div class="dolar-info mt-3">
                            <div class="loading" id="loading-dolar">
                                <i class="fas fa-spinner fa-spin me-2"></i>
                                Carregando cotação do dólar...
                            </div>
                            <div id="dolar-content" style="display: none;">
                                <h6><i class="fas fa-dollar-sign me-2"></i>Cotação do Dólar</h6>
                                <p class="mb-0">1 USD = R$ <span id="valor-dolar">0,00</span></p>
                                <small class="text-muted">Última atualização: <span id="data-atualizacao">--</span></small>
                            </div>
                            
                            <div class="mt-3">
                                <label for="limite-slider" class="form-label">
                                    <i class="fas fa-sliders-h me-1"></i>
                                    Limite máximo dos sliders
                                </label>
                                <select class="form-select" id="limite-slider">
                                    <option value="10000"selected>10.000 mensagens</option>
                                    <option value="50000">50.000 mensagens</option>
                                    <option value="100000">100.000 mensagens</option>
                                    <option value="500000">500.000 mensagens</option>
                                    <option value="1000000">1.000.000 mensagens</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-brand">
                <i class="fab fa-whatsapp me-2"></i>
                Calculadora WhatsApp by Valkhan Tech
            </div>
            <div class="footer-description">
                Ferramenta interna para cálculo de custos e rentabilidade de mensagens
            </div>
            <div class="footer-links">
                <a href="https://valkhan.com.br" target="_blank">Valkhan Tech</a>
                <a href="index.html">Precificador</a>
            </div>
            <div class="footer-copyright">
                &copy; 2025 <strong>Valkhan Tech</strong>. Todos os direitos reservados.
            </div>
        </div>
    </footer>

    <!-- Back to top button -->
    <a href="#" class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </a>

    <!-- JavaScript -->
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    
    <script>
        // Configurações de custos por categoria (em dólares)
        const CUSTOS_CATEGORIA = {
            marketing: 0.0625,
            utilidade: 0.008,
            autenticacao: 0.0315
        };

        // Multiplicadores para faturamento
        const MULTIPLICADORES = {
            marketing: 4,
            utilidade: 6,
            autenticacao: 3
        };        // Dados dos planos de assinatura
        const PLANOS = {
            0: { maxClientes: 40, rateio: 12.50, mensalidade: arredondarParaMultiplos25(50.00), porMil: 0, unitario: 0 },
            10000: { maxClientes: 40, rateio: 12.50, mensalidade: arredondarParaMultiplos25(50.00), porMil: 5.00, unitario: 0.0050 },
            30000: { maxClientes: 40, rateio: 12.50, mensalidade: arredondarParaMultiplos25(87.50), porMil: 2.92, unitario: 0.0029 },
            50000: { maxClientes: 30, rateio: 16.67, mensalidade: arredondarParaMultiplos25(116.69), porMil: 2.33, unitario: 0.0023 },
            100000: { maxClientes: 20, rateio: 25.00, mensalidade: arredondarParaMultiplos25(175.00), porMil: 1.75, unitario: 0.00175 },
            500000: { maxClientes: 5, rateio: 100.00, mensalidade: arredondarParaMultiplos25(700.00), porMil: 1.40, unitario: 0.0014 },
            1000000: { maxClientes: 1, rateio: 500.00, mensalidade: arredondarParaMultiplos25(3500.00), porMil: 3.50, unitario: 0.0035 }
        };

        let valorDolar = 0;

        // Função para carregar cotação do dólar
        async function carregarCotacaoDolar() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                valorDolar = data.rates.BRL;
                
                document.getElementById('valor-dolar').textContent = valorDolar.toFixed(2);
                document.getElementById('data-atualizacao').textContent = new Date().toLocaleString('pt-BR');
                
                document.getElementById('loading-dolar').style.display = 'none';
                document.getElementById('dolar-content').style.display = 'block';
                
                // Calcular valores iniciais
                calcularTodos();
            } catch (error) {
                console.error('Erro ao carregar cotação do dólar:', error);
                // Usar valor padrão se falhar
                valorDolar = 5.50;
                document.getElementById('valor-dolar').textContent = valorDolar.toFixed(2) + ' (padrão)';
                document.getElementById('data-atualizacao').textContent = 'Erro ao carregar';
                document.getElementById('loading-dolar').style.display = 'none';
                document.getElementById('dolar-content').style.display = 'block';
                calcularTodos();
            }
        }

        // Função para atualizar limite dos sliders
        function atualizarLimiteSliders() {
            const limite = document.getElementById('limite-slider').value;
            
            // Atualizar o max de todos os sliders
            document.getElementById('marketing-slider').max = limite;
            document.getElementById('utilidade-slider').max = limite;
            document.getElementById('autenticacao-slider').max = limite;
            
            // Se algum valor atual for maior que o novo limite, ajustar
            ['marketing', 'utilidade', 'autenticacao'].forEach(categoria => {
                const slider = document.getElementById(`${categoria}-slider`);
                if (parseInt(slider.value) > parseInt(limite)) {
                    slider.value = limite;
                    atualizarCategoria(categoria);
                }
            });
            
            calcularResultados();
        }

        // Função para obter nome do plano
        function obterNomePlano(valor) {
            switch(valor) {
                case '0': return 'Básico';
                case '10000': return '10K';
                case '30000': return '30K';
                case '50000': return '50K';
                case '100000': return '100K';
                case '500000': return '500K';
                case '1000000': return '1M';
                default: return 'Plano';
            }
        }        // Função para arredondar para múltiplos de 5 centavos
        function arredondarPara5Centavos(valor) {
            return Math.round(valor * 20) / 20;
        }
        
        // Função para arredondar para múltiplos de 25 (sem casas decimais)
        function arredondarParaMultiplos25(valor) {
            return Math.round(valor / 25) * 25;
        }
        function calcularCategoria(categoria, quantidade, precoCustomizado = null) {
            const custoUnitarioUSD = CUSTOS_CATEGORIA[categoria];
            const custoUnitarioBRL = custoUnitarioUSD * valorDolar;
            
            // Usar preço customizado se fornecido, caso contrário usar o calculado
            const precoCustoFinal = precoCustomizado?.custo || custoUnitarioBRL;
            const custoTotal = precoCustoFinal * quantidade;
            
            let faturamentoUnitario;
            if (precoCustomizado?.venda) {
                faturamentoUnitario = precoCustomizado.venda;
            } else {
                faturamentoUnitario = arredondarPara5Centavos(custoUnitarioBRL * MULTIPLICADORES[categoria]);
            }
            
            const faturamentoTotal = faturamentoUnitario * quantidade;
            
            return {
                custoTotal,
                faturamentoTotal,
                quantidade,
                custoUnitario: precoCustoFinal,
                faturamentoUnitario
            };
        }

        // Função para atualizar preços calculados nos campos
        function atualizarPrecosCampos(categoria) {
            if (valorDolar === 0) return;
            
            const custoUnitarioUSD = CUSTOS_CATEGORIA[categoria];
            const custoUnitarioBRL = custoUnitarioUSD * valorDolar;
            const faturamentoUnitario = arredondarPara5Centavos(custoUnitarioBRL * MULTIPLICADORES[categoria]);
            
            const campoCusto = document.getElementById(`${categoria}-preco-custo`);
            const campoVenda = document.getElementById(`${categoria}-preco-venda`);
            
            // Atualizar sempre com os valores calculados se os campos estiverem vazios
            if (!campoCusto.value || parseFloat(campoCusto.value) === 0) {
                campoCusto.value = custoUnitarioBRL.toFixed(4);
            }
            if (!campoVenda.value || parseFloat(campoVenda.value) === 0) {
                campoVenda.value = faturamentoUnitario.toFixed(2);
            }
        }

        // Função para obter preços customizados
        function obterPrecosCustomizados(categoria) {
            const campoCusto = document.getElementById(`${categoria}-preco-custo`);
            const campoVenda = document.getElementById(`${categoria}-preco-venda`);
            
            const precoCusto = parseFloat(campoCusto.value) || 0;
            const precoVenda = parseFloat(campoVenda.value) || 0;
            
            return precoCusto > 0 || precoVenda > 0 ? { custo: precoCusto, venda: precoVenda } : null;
        }

        // Função para atualizar display de uma categoria
        function atualizarCategoria(categoria) {
            const slider = document.getElementById(`${categoria}-slider`);
            const valueDisplay = document.getElementById(`${categoria}-value`);
            const custoDisplay = document.getElementById(`${categoria}-custo`);
            const faturamentoDisplay = document.getElementById(`${categoria}-faturamento`);
            
            const quantidade = parseInt(slider.value);
            valueDisplay.textContent = quantidade.toLocaleString('pt-BR');
            
            if (valorDolar > 0) {
                // Atualizar preços calculados nos campos
                atualizarPrecosCampos(categoria);
                
                // Obter preços customizados se existirem
                const precosCustomizados = obterPrecosCustomizados(categoria);
                
                const resultado = calcularCategoria(categoria, quantidade, precosCustomizados);
                custoDisplay.textContent = `R$ ${resultado.custoTotal.toFixed(2)}`;
                faturamentoDisplay.textContent = `R$ ${resultado.faturamentoTotal.toFixed(2)}`;
            }
        }        // Função para atualizar plano de assinatura
        function atualizarPlano() {
            const select = document.getElementById('plano-select');
            const planoSelecionado = PLANOS[select.value];
            const mensalidadeCustom = document.getElementById('plano-mensalidade-custom').value;
            
            // Usar mensalidade customizada se fornecida, senão usar padrão
            let mensalidadeFinal = planoSelecionado.mensalidade;
            if (mensalidadeCustom && mensalidadeCustom > 0) {
                mensalidadeFinal = arredondarParaMultiplos25(parseFloat(mensalidadeCustom));
            }
            
            document.getElementById('plano-rateio').textContent = `R$ ${planoSelecionado.rateio.toFixed(2)}`;
            document.getElementById('plano-mensalidade').textContent = `R$ ${mensalidadeFinal.toFixed(0)}`;
            
            // Se for o plano básico (sem conversas), não mostrar valor por conversa
            if (select.value === '0') {
                document.getElementById('plano-unitario').textContent = 'N/A';
            } else {
                document.getElementById('plano-unitario').textContent = `R$ ${planoSelecionado.unitario.toFixed(6)}`;
            }
        }

        // Função para obter mensalidade atual (considerando customização)
        function obterMensalidadeAtual(planoKey) {
            const planoBase = PLANOS[planoKey];
            const mensalidadeCustom = document.getElementById('plano-mensalidade-custom').value;
            
            if (mensalidadeCustom && mensalidadeCustom > 0) {
                return arredondarParaMultiplos25(parseFloat(mensalidadeCustom));
            }
            
            return planoBase.mensalidade;
        }

        // Função para calcular e exibir resultados
        function calcularResultados() {
            const totalMensagens = parseInt(document.getElementById('marketing-slider').value) +
                                 parseInt(document.getElementById('utilidade-slider').value) +
                                 parseInt(document.getElementById('autenticacao-slider').value);
            
            // Calcular custos e faturamentos por categoria com preços customizados
            const marketingPrecos = obterPrecosCustomizados('marketing');
            const utilidadePrecos = obterPrecosCustomizados('utilidade');
            const autenticacaoPrecos = obterPrecosCustomizados('autenticacao');
            
            const marketing = calcularCategoria('marketing', parseInt(document.getElementById('marketing-slider').value), marketingPrecos);
            const utilidade = calcularCategoria('utilidade', parseInt(document.getElementById('utilidade-slider').value), utilidadePrecos);
            const autenticacao = calcularCategoria('autenticacao', parseInt(document.getElementById('autenticacao-slider').value), autenticacaoPrecos);
            
            const custoMensagens = marketing.custoTotal + utilidade.custoTotal + autenticacao.custoTotal;
            const faturamentoMensagens = marketing.faturamentoTotal + utilidade.faturamentoTotal + autenticacao.faturamentoTotal;
              // Obter plano selecionado
            const planoSelecionado = document.getElementById('plano-select').value;
            const planoAtual = PLANOS[planoSelecionado];
            
            // Gerar tabela de resultados
            const tabela = document.getElementById('tabela-resultados');
            tabela.innerHTML = '';
              // Sempre adicionar linha do plano de assinatura
            const custoPlano = obterMensalidadeAtual(planoSelecionado);
            const faturamentoTotal = custoPlano + faturamentoMensagens;
            const planoNome = `R$ ${custoPlano.toFixed(0)}`;
            const cenarioNome = obterNomePlano(planoSelecionado);
            
            const linhaPlano = document.createElement('tr');
            linhaPlano.innerHTML = `
                <td><strong>${cenarioNome}</strong></td>
                <td>${planoNome}</td>
                <td>R$ ${faturamentoMensagens.toFixed(2)}</td>
                <td>R$ ${faturamentoTotal.toFixed(2)}</td>
            `;
            tabela.appendChild(linhaPlano);
            
            // Se não há mensagens, mostrar apenas o plano
            if (totalMensagens === 0) {
                const linhaMensagem = document.createElement('tr');
                linhaMensagem.innerHTML = `
                    <td colspan="4" class="text-center text-muted">
                        <i class="fas fa-info-circle me-2"></i>
                        Configure o volume de mensagens para ver cenários completos
                    </td>
                `;
                tabela.appendChild(linhaMensagem);
                
                // Atualizar resumo final
                document.getElementById('total-mensagens').textContent = '0';
                document.getElementById('custo-total').textContent = `R$ ${custoPlano.toFixed(2)}`;
                document.getElementById('faturamento-total').textContent = `R$ ${custoPlano.toFixed(2)}`;
                document.getElementById('custo-medio-msg').textContent = 'R$ 0,00';
                document.getElementById('rentabilidade-total').textContent = '0%';
                document.getElementById('rentabilidade-total').className = '';
                return;
            }
            
            // Calcular cenários adicionais baseados no plano atual
            const custoTotal = custoMensagens + custoPlano;
            const custoMedioPorMensagem = custoTotal / totalMensagens;            // Se o plano básico está selecionado, mostrar upgrade
            if (planoSelecionado === '0') {
                const planoUpgrade = PLANOS['10000'];
                const mensalidadeUpgrade = obterMensalidadeAtual('10000');
                const custoUpgrade = custoMensagens + mensalidadeUpgrade;
                const faturamentoUpgrade = mensalidadeUpgrade + faturamentoMensagens;
                const cenarioUpgrade = obterNomePlano('10000');
                
                const linhaUpgrade = document.createElement('tr');
                linhaUpgrade.innerHTML = `
                    <td><strong>${cenarioUpgrade}</strong></td>
                    <td>R$ ${mensalidadeUpgrade.toFixed(0)}</td>
                    <td>R$ ${faturamentoMensagens.toFixed(2)}</td>
                    <td>R$ ${faturamentoUpgrade.toFixed(2)}</td>
                `;
                tabela.appendChild(linhaUpgrade);            } else {
                // Cenário atual (plano + mensagens)
                const linhaAtual = document.createElement('tr');
                linhaAtual.innerHTML = `
                    <td><strong>Atual</strong></td>
                    <td>R$ ${custoPlano.toFixed(0)}</td>
                    <td>R$ ${faturamentoMensagens.toFixed(2)}</td>
                    <td>R$ ${faturamentoTotal.toFixed(2)}</td>
                `;
                tabela.appendChild(linhaAtual);
                
                // Verificar se há um plano superior
                const planosOrdenados = Object.keys(PLANOS).map(k => parseInt(k)).sort((a, b) => a - b);
                const indiceAtual = planosOrdenados.indexOf(parseInt(planoSelecionado));
                
                if (indiceAtual < planosOrdenados.length - 1) {
                    const proximoPlano = planosOrdenados[indiceAtual + 1].toString();
                    const planoSuperior = PLANOS[proximoPlano];
                    const mensalidadeSuperior = obterMensalidadeAtual(proximoPlano);
                    const custoSuperior = custoMensagens + mensalidadeSuperior;
                    const faturamentoSuperior = mensalidadeSuperior + faturamentoMensagens;
                    const cenarioSuperior = obterNomePlano(proximoPlano);
                      const linhaSuperior = document.createElement('tr');
                    linhaSuperior.innerHTML = `
                        <td><strong>${cenarioSuperior}</strong></td>
                        <td>R$ ${mensalidadeSuperior.toFixed(0)}</td>
                        <td>R$ ${faturamentoMensagens.toFixed(2)}</td>
                        <td>R$ ${faturamentoSuperior.toFixed(2)}</td>
                    `;
                    tabela.appendChild(linhaSuperior);
                }
            }
            
            // Atualizar resumo final
            document.getElementById('total-mensagens').textContent = totalMensagens.toLocaleString('pt-BR');
            document.getElementById('custo-total').textContent = `R$ ${custoTotal.toFixed(2)}`;
            document.getElementById('faturamento-total').textContent = `R$ ${faturamentoTotal.toFixed(2)}`;
            document.getElementById('custo-medio-msg').textContent = `R$ ${custoMedioPorMensagem.toFixed(4)}`;
            
            const rentabilidadeFinal = ((faturamentoTotal - custoTotal) / custoTotal * 100);
            const rentabilidadeElement = document.getElementById('rentabilidade-total');
            rentabilidadeElement.textContent = `${rentabilidadeFinal.toFixed(1)}%`;
            rentabilidadeElement.className = rentabilidadeFinal > 0 ? 'valor-positivo' : 'valor-negativo';
        }

        // Função para calcular todos os valores
        function calcularTodos() {
            if (valorDolar === 0) return;
            
            atualizarCategoria('marketing');
            atualizarCategoria('utilidade');
            atualizarCategoria('autenticacao');
            atualizarPlano();
            calcularResultados();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar cotação do dólar
            carregarCotacaoDolar();
            
            // Sliders
            document.getElementById('marketing-slider').addEventListener('input', () => {
                atualizarCategoria('marketing');
                calcularResultados();
            });
            
            document.getElementById('utilidade-slider').addEventListener('input', () => {
                atualizarCategoria('utilidade');
                calcularResultados();
            });
            
            document.getElementById('autenticacao-slider').addEventListener('input', () => {
                atualizarCategoria('autenticacao');
                calcularResultados();
            });
            
            // Campos de preço - Marketing
            document.getElementById('marketing-preco-custo').addEventListener('input', () => {
                atualizarCategoria('marketing');
                calcularResultados();
            });
            
            document.getElementById('marketing-preco-venda').addEventListener('input', () => {
                atualizarCategoria('marketing');
                calcularResultados();
            });
            
            // Campos de preço - Utilidade
            document.getElementById('utilidade-preco-custo').addEventListener('input', () => {
                atualizarCategoria('utilidade');
                calcularResultados();
            });
            
            document.getElementById('utilidade-preco-venda').addEventListener('input', () => {
                atualizarCategoria('utilidade');
                calcularResultados();
            });
            
            // Campos de preço - Autenticação
            document.getElementById('autenticacao-preco-custo').addEventListener('input', () => {
                atualizarCategoria('autenticacao');
                calcularResultados();
            });
            
            document.getElementById('autenticacao-preco-venda').addEventListener('input', () => {
                atualizarCategoria('autenticacao');
                calcularResultados();
            });
            
            // Select de plano
            document.getElementById('plano-select').addEventListener('change', () => {
                atualizarPlano();
                calcularResultados();
            });
            
            // Select de limite dos sliders
            document.getElementById('limite-slider').addEventListener('change', () => {
                atualizarLimiteSliders();
            });
            
            // Campo de mensalidade customizada
            document.getElementById('plano-mensalidade-custom').addEventListener('input', () => {
                const valor = parseFloat(document.getElementById('plano-mensalidade-custom').value);
                if (valor && valor > 0) {
                    // Arredondar para múltiplos de 25 e atualizar o campo
                    const valorArredondado = arredondarParaMultiplos25(valor);
                    document.getElementById('plano-mensalidade-custom').value = valorArredondado;
                }
                atualizarPlano();
                calcularResultados();
            });

            // Inicializar limite dos sliders
            atualizarLimiteSliders();
            
            // Back to top functionality
            const backToTop = document.querySelector('.back-to-top');
            if (backToTop) {
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 100) {
                        backToTop.style.display = 'block';
                    } else {
                        backToTop.style.display = 'none';
                    }
                });
                
                backToTop.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Precificador by Valkhan Tech</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #f4f4f4;
            padding: 40px;
        }

        h1 {
            color: #006699;
            margin-bottom: 30px;
        }

        .container-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        footer {
            margin-top: 40px;
            text-align: center;
            color: #555;
        }

        .preco-badge {
            font-size: 1.2rem;
            font-weight: bold;
            padding: 0.2em 0.5em;
            border-radius: 0.5rem;
            display: inline-block;
            margin-bottom: 0.5em;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <h1 class="text-center">
            Precificador
            <i class="fa-regular fa-circle-question ms-2" id="btnAjuda" style="cursor: pointer;"></i>
        </h1>

        <div class="row">
            <div class="col-12 col-lg-6">
                <form id="form-simulacao" class="container-box">
                    <div class="row">
                        <div class="mb-3 col-12 col-md-6">
                            <label class="form-label">Preço de Custo (R$)</label>
                            <input type="number" id="custo" class="form-control" value="10" step="0.01">
                        </div>
                        <div class="mb-3 col-12 col-md-6">
                            <label class="form-label">Preço de Venda (R$) <small>(0 para calcular)</small></label>
                            <input type="number" id="preco_venda" class="form-control" value="0" step="0.01">
                        </div>
                        <div class="mb-3 col-12 col-md-6">
                            <label class="form-label">Quantidade para Simulação</label>
                            <input type="number" id="quantidade" class="form-control" value="10">
                        </div>
                        <div class="mb-3 col-12 col-md-6">
                            <label class="form-label">Margem de Lucro Desejada (%)</label>
                            <input type="number" id="margem_desejada" class="form-control" value="30">
                        </div>
                        <div class="mb-3 col-12 col-md-6">
                            <label class="form-label">Custo com Embalagem (R$)</label>
                            <input type="number" id="embalagem" class="form-control" value="1.50" step="0.01">
                        </div>
                        <div class="mb-3 col-12 col-md-6">
                            <label class="form-label">Taxa da Plataforma (%)</label>
                            <input type="number" id="taxa" class="form-control" value="20">
                        </div>
                        <div class="mb-3 col-12 col-md-6">
                            <label class="form-label">Imposto sobre Venda (%)</label>
                            <input type="number" id="imposto" class="form-control" value="12">
                        </div>
                        <div class="mb-3 col-12 col-md-6">
                            <label class="form-label">Imposto MEI (R$)</label>
                            <input type="number" id="imposto_mei" class="form-control" value="0" step="0.01">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Simular</button>
                </form>
            </div>

            <div class="col-12 col-lg-6">
                <div id="resultado" class="container-box" style="display: none">
                    <h2>Resultado da Simulação</h2>
                    <p>
                        <strong>Preço de Venda Sugerido:</strong>
                        <span id="preco_sugerido" class="preco-badge bg-success text-white"></span>
                    </p>
                    <hr>
                    <p><strong>Detalhamento dos Custos:</strong></p>
                    <ul>
                        <li>Produto: <span id="custo_produto"></span></li>
                        <li>Embalagem: <span id="custo_embalagem"></span></li>
                        <li>Taxas Plataforma: <span id="custo_taxa"></span></li>
                        <li>Impostos: <span id="custo_imposto"></span></li>
                        <li>Outros: <span id="custo_outros"></span></li>
                    </ul>
                    <hr>
                    <p><strong>Investimento Total:</strong> <span id="investimento"></span></p>
                    <p><strong>Receita Total:</strong> <span id="receita"></span></p>
                    <p><strong>Lucro Total:</strong> <span id="lucro"></span></p>
                    <p><strong>Margem Real:</strong> <span id="margem"></span>%</p>
                </div>
            </div>
        </div>

        <footer>
            Developed by <a href="https://valkhan.com.br" target="_blank">Valkhan Tech</a>
        </footer>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalAjuda" tabindex="-1" aria-labelledby="modalAjudaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalAjudaLabel">Como usar o Simulador</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Este simulador foi criado para ajudar empreendedores e vendedores a avaliarem a viabilidade
                        financeira de revender um produto, considerando custos, taxas e lucros.</p>
                    <ul>
                        <li><strong>Preço de Custo:</strong> quanto você paga pelo produto.</li>
                        <li><strong>Preço de Venda:</strong> quanto pretende vender. Se deixar como 0, o sistema calcula
                            com base na margem desejada.</li>
                        <li><strong>Quantidade:</strong> total de unidades simuladas.</li>
                        <li><strong>Margem de Lucro Desejada:</strong> margem percentual que você espera ganhar sobre a
                            venda.</li>
                        <li><strong>Custo com Embalagem:</strong> custo por unidade com embalagem e/ou mão de obra
                            operacional.</li>
                        <li><strong>Taxa da Plataforma:</strong> percentual cobrado por marketplace ou comissão de
                            vendedor.</li>
                        <li><strong>Imposto sobre Venda:</strong> percentual estimado de impostos. Empresas no Simples
                            costumam pagar em torno de 12%.</li>
                        <li><strong>Imposto MEI:</strong> se informado (> 0), substitui o percentual de imposto por um
                            valor fixo.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        const campos = [
            'custo', 'embalagem', 'taxa', 'imposto',
            'margem_desejada', 'preco_venda', 'quantidade', 'imposto_mei'
        ];

        function formatarReal(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        }

        window.addEventListener('DOMContentLoaded', () => {
            campos.forEach(campo => {
                const valor = localStorage.getItem(campo);
                if (valor !== null) {
                    document.getElementById(campo).value = valor;
                }
            });

            // Abrir modal no primeiro acesso
            if (!localStorage.getItem('ajuda_vista')) {
                const ajudaModal = new bootstrap.Modal(document.getElementById('modalAjuda'));
                ajudaModal.show();
                localStorage.setItem('ajuda_vista', '1');
            }

            // Abrir modal ao clicar no ícone
            document.getElementById('btnAjuda').addEventListener('click', () => {
                const ajudaModal = new bootstrap.Modal(document.getElementById('modalAjuda'));
                ajudaModal.show();
            });
        });

        campos.forEach(campo => {
            document.getElementById(campo).addEventListener('input', (e) => {
                localStorage.setItem(campo, e.target.value);
            });
        });

        document.getElementById('form-simulacao').addEventListener('submit', function (e) {
            e.preventDefault();

            const custo = parseFloat(document.getElementById('custo').value);
            const embalagem = parseFloat(document.getElementById('embalagem').value);
            const taxa = parseFloat(document.getElementById('taxa').value) / 100;
            const imposto = parseFloat(document.getElementById('imposto').value) / 100;
            const impostoMei = parseFloat(document.getElementById('imposto_mei').value);
            const margemDesejada = parseFloat(document.getElementById('margem_desejada').value) / 100;
            const precoVendaInput = parseFloat(document.getElementById('preco_venda').value);
            const quantidade = parseInt(document.getElementById('quantidade').value);

            const custoUnitario = custo + embalagem;

            let precoVenda;
            if (precoVendaInput > 0) {
                precoVenda = precoVendaInput;
            } else {
                const impostoCalculado = (impostoMei > 0 ? 0 : imposto);
                precoVenda = custoUnitario / (1 - taxa - imposto - margemDesejada);
            }

            const investimento = custoUnitario * quantidade;
            const receita = precoVenda * quantidade;
            const totalTaxa = receita * taxa;
            const totalImposto = impostoMei > 0 ? impostoMei : receita * imposto;
            const lucro = receita - investimento - totalTaxa - totalImposto;
            const margemReal = (lucro / receita) * 100;

            // Badge verde Bootstrap e fonte maior
            document.getElementById('preco_sugerido').innerText = formatarReal(precoVenda);

            // Formatação dos valores
            document.getElementById('investimento').innerText = formatarReal(investimento);
            document.getElementById('receita').innerText = formatarReal(receita);

            // Lucro e margem com cor dinâmica do Bootstrap
            const lucroSpan = document.getElementById('lucro');
            const margemSpan = document.getElementById('margem');
            lucroSpan.innerText = formatarReal(lucro);
            margemSpan.innerText = margemReal.toFixed(2);

            lucroSpan.className = '';
            margemSpan.className = '';
            if (margemReal < 3) {
                lucroSpan.classList.add('text-danger', 'fw-bold');
                margemSpan.classList.add('text-danger', 'fw-bold');
            } else if (margemReal < 10) {
                lucroSpan.classList.add('text-warning', 'fw-bold');
                margemSpan.classList.add('text-warning', 'fw-bold');
            } else if (margemReal < 20) {
                lucroSpan.classList.add('text-primary', 'fw-bold');
                margemSpan.classList.add('text-primary', 'fw-bold');
            } else {
                lucroSpan.classList.add('text-success', 'fw-bold');
                margemSpan.classList.add('text-success', 'fw-bold');
            }

            document.getElementById('custo_produto').innerText = formatarReal(custo * quantidade);
            document.getElementById('custo_embalagem').innerText = formatarReal(embalagem * quantidade);
            document.getElementById('custo_taxa').innerText = formatarReal(totalTaxa);
            document.getElementById('custo_imposto').innerText = formatarReal(totalImposto);
            document.getElementById('custo_outros').innerText = formatarReal(0);

            document.getElementById('resultado').style.display = 'block';
        });    
    </script>

</body>

</html>